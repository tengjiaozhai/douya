# Douya 产品说明（面向产品/运营）

## 1. Douya 是什么

Douya 是一个面向企业场景的 AI 助手后端系统。它把「多智能体协作、知识库检索、文档理解、飞书消息交互」整合在一起，帮助业务快速搭建可用的智能问答与助手能力。

一句话理解：

- **用户提问 → 系统自动选择合适能力（记忆/知识库/联网/视觉）→ 输出可追溯答案。**

---

## 2. 解决什么问题

Douya 主要解决 4 类业务痛点：

1. **知识问答不稳定**：传统问答容易“编答案”，Douya 通过知识库检索和引用降低幻觉。
2. **文档内容难利用**：PDF、手册、图文资料难被模型直接高质量使用，Douya 提供文档切分与向量化能力。
3. **用户偏好难沉淀**：用户每次都要重复说明偏好，Douya 提供记忆机制和偏好学习。
4. **渠道集成成本高**：Douya 已集成飞书通道，可直接对接企业内部沟通场景。

---

## 3. 核心能力（当前版本）

### 3.1 多智能体协同

系统内置多个角色（如美食专家、视觉专家、通用助手），由监督者自动路由任务，减少人工规则维护成本。

### 3.2 RAG 知识检索

- 支持本地知识检索（向量库）
- 支持联网补充（在本地无结果时）
- 支持引用信息回传（便于结果可追溯）

### 3.3 PDF 文档双引擎切分（新增）

上传 PDF 时可选择两种切分引擎：

- `JAVA`（默认）：稳定、依赖少，适合常规场景
- `PYTHON`：适合更灵活的切分策略（已集成 `apps/split-document`）

可靠性保障：

- 当 `PYTHON` 切分失败时，系统自动回退 `JAVA`，确保上传流程不中断。

### 3.4 飞书集成

支持飞书消息接收、发送和事件处理，可用于企业内部 AI 助手落地。

---

## 4. 典型用户流程

### 流程 A：知识问答

1. 用户发起问题
2. 系统判断是否需要检索知识
3. 检索知识库并组织上下文
4. 返回答案（可带来源线索）

### 流程 B：文档入库

1. 上传 PDF
2. 系统抽取文本与图片
3. 按策略切分（JAVA/PYTHON）
4. 向量化入库
5. 后续问答可引用该文档内容

### 流程 C：飞书助手

1. 用户在飞书发起提问
2. Douya 接收并处理
3. 返回结构化消息内容

---

## 5. 你最需要关心的接口

### 5.1 上传并处理 PDF

- `POST /api/douya/eating/pdf/upload`
- 关键参数：
  - `file`: PDF 文件
  - `documentName`（可选）
  - `splitStrategy`（可选）：`JAVA` 或 `PYTHON`

### 5.2 查看向量库状态

- `GET /api/douya/eating/vector/status?limit=100`

### 5.3 手动去重清洗向量

- `POST /api/douya/eating/vector/clean`

---

## 6. 版本边界与预期

当前版本适合：

- 企业内部知识问答 MVP
- 文档驱动型助手（手册、规范、教程）
- 飞书内的 AI 助手试点

当前版本不等于：

- 完整 BI 报表系统
- 全自动工作流编排平台
- 零配置即上线的 SaaS 产品

---

## 7. 上线前建议（产品视角）

1. 先确定 1-2 个高价值场景（例如：FAQ、操作手册问答）
2. 先导入核心文档，再做小范围灰度
3. 明确回答口径（是否必须带引用）
4. 设定验收指标（命中率、满意度、响应时延）

---

## 8. 补充说明

- 技术详细说明请看根目录 `README.md`
- Python 切分来源与兼容说明请看 `apps/split-document/README.upstream.md`
